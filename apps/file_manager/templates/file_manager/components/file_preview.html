{% load static file_extension %}

{% if file_path %}
  {% with file_extension=file_path|file_extension %}
    {% if file_extension in '.jpg,.jpeg,.png,.gif,.svg,.webp' %}
      <!-- Image preview -->
      <img src="{% url 'file_manager:download_file' file_path %}" alt="{{ filename }}" class="img-fluid" style="max-height: 80vh;">
    {% elif file_extension in '.mp4,.webm,.ogg' %}
      <!-- Video preview -->
      <video class="w-100" style="max-height: 80vh;" controls>
        <source src="{% url 'file_manager:download_file' file_path %}" type="video/{{ file_extension|slice:'1:' }}">
        Your browser does not support the video tag.
      </video>
    {% elif file_extension in '.pdf' %}
      <!-- PDF preview -->
      <iframe src="{% url 'file_manager:download_file' file_path %}" width="100%" height="600px" frameborder="0"></iframe>
    {% elif file_extension in '.txt,.md,.csv,.json,.xml,.html,.css,.js' %}
      <!-- Text preview -->
      <pre class="bg-light p-3" style="max-height: 80vh; overflow: auto;">{{ file_content }}</pre>
    {% else %}
      <!-- Unsupported file type -->
      <div class="text-center py-5">
        <i class="fas fa-file fa-5x text-secondary mb-3"></i>
        <p>Preview not available for this file type.</p>
        <a href="{% url 'file_manager:download_file' file_path %}" class="btn btn-primary mt-3">
          <i class="fas fa-download me-2"></i> Download File
        </a>
      </div>
    {% endif %}
  {% endwith %}
{% else %}
  <!-- No file selected -->
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading preview...</p>
  </div>
{% endif %}
